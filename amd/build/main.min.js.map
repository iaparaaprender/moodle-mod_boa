{"version":3,"file":"main.min.js","sources":["../src/main.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * JS to connect with BoA repositories.\n *\n * @module     mod_boa/main\n * @copyright  2024 David Herney @ BambuCo\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(['jquery', 'core/modal_factory', 'core/modal_events', 'core/templates', 'core/str', 'core/log'],\n    function($, ModalFactory, ModalEvents, Templates, Str, Log) {\n\n    var $errorBox = null;\n\n    // Load strings.\n    var strings = [\n        {key: 'noresultsfound', component: 'mod_boa'},\n    ];\n    var s = [];\n\n    $.boasearch = function(el, params) {\n        var $boasearch = $(el);\n        var $boasearchBox;\n        var $boasearchSuggestions = $('<ul class=\"boasearch-suggestions\"></ul>');\n        var cacheResults = [];\n        var requestObjects = [];\n        var startRecord = 0;\n\n        $boasearch.wrap('<span class=\"boasearch-box\"></span>');\n\n        $boasearchBox = $boasearch.parent();\n        $boasearchBox.append($boasearchSuggestions);\n\n        $boasearchSuggestions.customReset = function() {\n            $boasearchSuggestions.empty();\n            $boasearchSuggestions.hide();\n            $boasearchSuggestions.data('off', true);\n        };\n\n        $boasearchSuggestions.customReset();\n\n        if (params.options) {\n            params.options = $.extend({}, $.boasearch.defaults.options, params.options);\n        }\n\n        if (params.events) {\n            params.events = $.extend({}, $.boasearch.defaults.events, params.events);\n        }\n\n        if (params.results) {\n            params.results = $.extend({}, $.boasearch.defaults.results, params.results);\n        }\n\n        $boasearch.conf = $.extend({}, $.boasearch.defaults, params);\n\n        $boasearch.attr('autocomplete', 'off');\n\n        var ferror = function(txt, level) {\n            switch (level) {\n                case 'dev':\n                    if ($boasearch.conf.debug) {\n                        Log.debug('BoASearch - ' + txt);\n                    }\n                break;\n                default:\n                    Log.debug('BoASearch - ' + txt);\n            }\n        };\n\n        // Store a reference to the BoASearch object.\n        $.data(el, \"boasearch\", $boasearch);\n\n        // Private methods.\n        var methods = {\n            init: function() {\n                if (!$boasearch.conf.apiuri) {\n                    ferror('Configuration error: You need set the API URI.');\n                    return;\n                }\n\n                $boasearch.on('keypress', function(event) {\n                    if (event.keyCode) {\n                        switch (event.keyCode) {\n                            case 13: // Enter\n                                event.preventDefault();\n                                $boasearchSuggestions.customReset();\n                                break;\n                            case 27: // Escape\n                                $boasearchSuggestions.customReset();\n                                break;\n                            case 38: // Up\n                                if (!$boasearchSuggestions.data('off')) {\n                                    methods.previousItemMarkup();\n                                }\n                                break;\n                            case 40: // Down\n                                if (!$boasearchSuggestions.data('off')) {\n                                    methods.nextItemMarkup();\n                                }\n                                break;\n                        }\n                    }\n                });\n\n                $boasearch.on('keyup', function(event) {\n                    var val = $boasearch.val();\n\n                    var specialKeys = [13, 16, 17, 18, 27, 33, 34, 35, 36, 37, 38, 39, 45, 144];\n                    if (!$boasearchSuggestions.data('off')) {\n                        specialKeys[specialKeys.length] = 40;\n                    }\n\n                    if (event.keyCode && specialKeys.indexOf(event.keyCode) == -1) {\n                        if (val.length >= $boasearch.conf.options.minLetters) {\n                            $boasearch.printSuggestions(val);\n                        } else {\n                            $boasearchSuggestions.customReset();\n                        }\n                    } else if (event.keyCode === 13) {\n                        $boasearch.search();\n                    }\n                });\n\n                $boasearchBox.on('focusout', function() {\n                    window.setTimeout(function() {\n                        $boasearchSuggestions.customReset();\n                    }, 100);\n                });\n            },\n\n            /**\n             * Build a suggestion item\n             *\n             * @param {object} item the current item data to render\n             * @param {string} query the last query submited to the server.\n             */\n            getItemMarkup: function(item, query) {\n                var text = item.query != '' ? methods.highlightString(item.query, query) : '';\n\n                var $item = $('<li>' + text + '</li>');\n\n                $item.on('click', function() {\n                    var $this = $(this);\n                    $boasearchSuggestions.customReset();\n                    $boasearch.val($this.text());\n                });\n\n                return $item;\n            },\n\n            highlightString: function(str, query) {\n                var n = str.toLowerCase().indexOf(query.toLowerCase());\n                if (n >= 0) {\n                    var before = str.substr(0, n);\n                    var word = str.substr(n, query.length);\n                    var after = str.substr(n + query.length);\n\n                    str = before + '<em>' + word + '</em>' + after;\n                }\n                return str;\n            },\n\n            nextItemMarkup: function() {\n                var $current = $boasearchSuggestions.find('.current');\n                var oldposition, newposition;\n\n                if ($current.length < 1) {\n                    oldposition = -1;\n                } else {\n                    oldposition = $current.index();\n                }\n\n                newposition = oldposition + 1;\n\n                if ($boasearchSuggestions.find('> li').length <= newposition) {\n                    newposition = 0;\n                }\n\n                $current.removeClass('current');\n                var $new = $boasearchSuggestions.children().eq(newposition);\n\n                $new.addClass('current');\n                $boasearch.val($new.text());\n            },\n\n            previousItemMarkup: function() {\n                var $current = $boasearchSuggestions.find('.current');\n                var oldposition, newposition;\n\n                if ($current.length < 1) {\n                    oldposition = -1;\n                } else {\n                    oldposition = $current.index();\n                }\n\n                newposition = oldposition - 1;\n\n                if (newposition < 0) {\n                    newposition = $boasearchSuggestions.find('> li').length - 1;\n                }\n\n                $current.removeClass('current');\n                var $new = $boasearchSuggestions.children().eq(newposition);\n\n                $new.addClass('current');\n                $boasearch.val($new.text());\n            },\n\n            printItemsMarkup: function(title, data, query) {\n\n                if (data.length > 0) {\n                    $.each(data, function(k, item) {\n                        var $item = methods.getItemMarkup(item, query, k);\n                        $boasearchSuggestions.append($item);\n                    });\n\n                    $boasearchSuggestions.show();\n                    $boasearchSuggestions.data('off', false);\n                }\n            },\n\n            initSearch: function() {\n                if (typeof $boasearch.conf.events.onstart == 'function') {\n                    $boasearch.conf.events.onstart(startRecord > 0);\n                } else {\n                    if ($boasearch.conf.results.target) {\n                        $($boasearch.conf.results.target).addClass('loading');\n                        if (startRecord === 0) {\n                            $($boasearch.conf.results.target).empty();\n                        }\n                    }\n                }\n            },\n\n            printResultSearch: function(data) {\n\n                if (typeof $boasearch.conf.events.onfound == 'function') {\n                    $boasearch.conf.events.onfound(data, startRecord);\n                } else {\n                    if ($boasearch.conf.results.target) {\n                        var $target = $($boasearch.conf.results.target);\n                        $target.removeClass('loading');\n\n                        $.each(data, function(k, item) {\n                            var $html = $('<div class=\"boa-video\"></div>');\n                            var preview = this.choosePreview(item);\n                            $html.append('<a href=\"' + item.about + '\"><h5>' + item.metadata.general.title.none + '</h5></a>');\n                            $html.append('<a href=\"' + item.about + '\"><img src=\"' + preview + '.img\" /></a>');\n                            $html.append('<p>' + item.metadata.general.description.none + '</p>');\n\n                            $target.append($html);\n                        });\n                    }\n                }\n            },\n\n            choosePreview: function(item) {\n\n                if ('alternate' in item.manifest && item.manifest.entrypoint) {\n\n                    var alternatebase;\n\n                    if (item.id.indexOf('/content/') >= 0) {\n                        alternatebase = item.id.substr(item.id.indexOf('/content/') + 9);\n                    } else {\n                        alternatebase = item.manifest.entrypoint;\n                    }\n\n                    var alterpath = item.about + '/!/.alternate/' + alternatebase;\n\n                    if (item.manifest.alternate.indexOf('preview.png') >= 0) {\n                        return alterpath + '/preview.png';\n                    } else if (item.manifest.alternate.indexOf('thumb.png') >= 0) {\n                        return alterpath + '/thumb.png';\n                    }\n                }\n\n                return item.about + '.img?s=128';\n            }\n        };\n\n        // Public methods\n        $boasearch.printSuggestions = function(query) {\n\n            for (var request in requestObjects) {\n                if (request && typeof request === 'object') {\n                    request.abort();\n                }\n            }\n\n            $boasearchSuggestions.customReset();\n            requestObjects = [];\n\n            var uri = $boasearch.conf.apiuri;\n            uri = uri.substr(0, uri.indexOf('/resources'));\n            uri += '/queries.json';\n\n            var params = {\n                \"q\": query,\n                \"(n)\": $boasearch.conf.options.suggestionsSize\n            };\n\n            if ($boasearch.conf.filters.length > 0) {\n                var filters = $boasearch.conf.filters.join(' AND ');\n                params.filter = filters;\n            }\n\n            // Not for specific catalogues yet.\n            var cataloguename = '';\n            requestObjects[requestObjects.length] = $.get(uri, params, function(data) {\n\n                if (data.length > 0) {\n                    data.sort(function(a, b) {\n                        return b.size - a.size;\n                    });\n\n                    methods.printItemsMarkup(cataloguename, data, query);\n                }\n            });\n        };\n\n        $boasearch.search = function() {\n\n            var currentTime = Date.now();\n\n            var query = $boasearch.val();\n\n            if (query.length < $boasearch.conf.options.minLetters) {\n                return false;\n            }\n\n            methods.initSearch();\n\n            if (cacheResults[query] && cacheResults[query].timeQuery > (currentTime - $boasearch.conf.options.cacheLife)) {\n                methods.printResultSearch(cacheResults[query].data);\n                return true;\n            }\n\n            cacheResults[query] = {\n                timeQuery: currentTime,\n                data: []\n            };\n\n            var params = {\n                \"q\": query,\n                \"(n)\": $boasearch.conf.options.resultsSize,\n                \"(s)\": startRecord\n            };\n\n            if ($boasearch.conf.filters.length > 0) {\n                $.each($boasearch.conf.filters, function(k, filter) {\n                    if (typeof filter.value == 'object') {\n                        $.each(filter.value, function(m, val) {\n                            params['(meta)[' + filter.meta + '][' + m + ']'] = val;\n                        });\n                    } else {\n                        params['(meta)[' + filter.meta + ']'] = filter.value;\n                    }\n                });\n            }\n\n            $.ajax({\n                url: $boasearch.conf.apiuri,\n                data: params,\n                dataType: 'json',\n                success: function(data) {\n                    $boasearchSuggestions.empty();\n\n                    if (typeof data === 'object' && data.error) {\n                        $boasearch.conf.events.onerror(data);\n                        data = [];\n                    }\n\n                    if (data.length > 0) {\n                        data.sort(function(a, b) {\n                            return b.size - a.size;\n                        });\n\n                        cacheResults[query].data = data;\n\n                    }\n\n                    methods.printResultSearch(data);\n                },\n                error: function(xhr) {\n                    var data = xhr.responseText;\n                    $boasearch.conf.events.onerror($.parseJSON(data));\n                },\n                fail: function(xhr) {\n                    var data = xhr.responseText;\n                    $boasearch.conf.events.onerror($.parseJSON(data));\n                }\n            });\n\n            return true;\n\n        };\n\n        $boasearch.searchMore = function() {\n            startRecord += $boasearch.conf.options.resultsSize;\n            $boasearch.search();\n        };\n\n        $boasearch.restart = function() {\n            startRecord = 0;\n        };\n\n        $boasearch.choosePreview = methods.choosePreview;\n\n        // BoA: Initialize.\n        methods.init();\n    };\n\n    // BoA: Default Settings.\n    $.boasearch.defaults = {\n        apiuri: null,\n        catalogues: [],\n        filters: [],\n        options: {\n            suggestionsSize: 10,\n            resultsSize: 10,\n            minLetters: 3,\n            cacheLife: 60000 // 60 seconds\n        },\n        debug: false,\n        results: {\n            target: null,\n            template: null\n        },\n        events: {\n            onstart: null,\n            onfound: null,\n            onerror: function(error) {\n                Log.debug('BoASearch - search error');\n                Log.debug(error);\n                return true;\n            }\n        }\n    };\n\n    // BoA: Plugin Function.\n    $.fn.boasearch = function(params, paramval) {\n        if (params === undefined) {\n            params = {};\n        }\n\n        if (typeof params === \"object\") {\n            return this.each(function() {\n                new $.boasearch(this, params);\n            });\n        } else {\n\n            var $boasearch = null;\n\n            if ('data' in this) {\n                $boasearch = this.data('boasearch');\n            } else {\n\n                if ('data' in $(this)) {\n                    $boasearch = $(this).data('boasearch');\n                }\n            }\n\n            if ($boasearch) {\n\n                switch (params) {\n                    case \"search\": $boasearch.search(); break;\n                    case \"nextsearch\": $boasearch.searchMore(); break;\n                    case \"option\": return $boasearch.conf.options[paramval];\n                    case \"restart\": $boasearch.restart(); break;\n                    case \"choosePreview\": return $boasearch.choosePreview(paramval);\n                }\n            } else {\n                Log.debug('Error in boasearch object');\n            }\n        }\n\n        return true;\n    };\n\n    var chooseview = function(data) {\n\n        var $res;\n\n        // If it is a external resource.\n        if (data.manifest.conexion_type && data.manifest.conexion_type == 'external') {\n            $res = $('<iframe></iframe>');\n            $res.attr('src', data.manifest.url);\n\n            var $reslink = $('<p><a target=\"_blank\"></a></p>');\n            $reslink.find('a').attr('href', data.manifest.url).html(data.manifest.url);\n\n            return $res.get(0).outerHTML + $reslink.get(0).outerHTML;\n        }\n\n        if (data.metadata.technical && data.metadata.technical.format) {\n\n            if (data.metadata.technical.format.match(/pdf/gi) ||\n                    data.metadata.technical.format.match(/html/gi) ||\n                    data.metadata.technical.format.match(/tepuy/gi)) {\n                $res = $('<iframe></iframe>');\n                $res.attr('src', data.about + '/!/').attr('type', data.metadata.technical.format);\n\n            } else {\n\n                var src = '';\n                var alternatebase;\n                if (data.id.indexOf('/content/') >= 0) {\n                    alternatebase = data.id.substr(data.id.indexOf('/content/') + 9);\n                } else {\n                    alternatebase = data.manifest.entrypoint;\n                }\n\n                if (data.manifest.alternate && data.manifest.entrypoint) {\n                    var alterpath = data.about + '/!/.alternate/' + alternatebase + '/';\n                    var name = '';\n\n                    if (data.metadata.technical.format.match(/video/gi) ||\n                            data.metadata.technical.format.match(/audio/gi) ||\n                            data.metadata.technical.format.match(/image/gi)) {\n\n                        if (typeof data.manifest.alternate == 'object') {\n                            name = data.manifest.alternate.find(e => /small/g.test(e));\n\n                            if (name) {\n                                src = alterpath + name;\n                            } else {\n                                name = data.manifest.alternate.find(e => /medium/g.test(e));\n                                src = name ? alterpath + name : data.about + '/!/' + data.manifest.entrypoint;\n                            }\n                        } else {\n                            src = data.about + '/!/' + data.manifest.entrypoint;\n                        }\n                    } else {\n                        name = typeof data.manifest.alternate == 'object' ?\n                                        data.manifest.alternate.find(e => /thumb/g.test(e)) : '';\n                        src = name ? alterpath + name : data.manifest.customicon;\n                    }\n\n                } else {\n                    if ('technical' in data.metadata && 'format' in data.metadata.technical &&\n                            (data.metadata.technical.format.match(/video/gi) ||\n                            data.metadata.technical.format.match(/audio/gi) ||\n                            data.metadata.technical.format.match(/image/gi))) {\n                        src = data.about + '/!/';\n                    } else {\n                        src = data.manifest.customicon;\n                    }\n                }\n\n                if (data.metadata.technical.format.match(/video/gi)) {\n                    $res = $('<video controls><source></source></video>');\n                    $res.find('source').attr('src', src).attr('type', data.metadata.technical.format);\n\n                } else if (data.metadata.technical.format.match(/audio/gi)) {\n                    $res = $('<audio controls><source></source></audio>');\n                    $res.find('source').attr('src', src).attr('type', data.metadata.technical.format);\n\n                } else {\n                    $res = $('<img />');\n                    $res.attr('src', src).attr('alt', data.metadata.general.title.none);\n                }\n\n            }\n\n            return $res.get(0).outerHTML;\n        }\n\n        return $res;\n    };\n\n    var isdownloadable = function(data) {\n        // ToDo: validate by content type.\n        return !data.manifest.conexion_type || data.manifest.conexion_type != 'external';\n    };\n\n    var showmessage = function(text, type, info, asreturn) {\n        type = type ? type : 'error';\n        info = info ? info : '';\n\n        var content = $('#boa-tpl-error-item')[0].innerHTML;\n\n        content = content.replace(/{message}/g, text);\n        content = content.replace(/{info}/g, info);\n        content = content.replace(/{type}/g, type);\n\n        if (asreturn) {\n            return $(content);\n        } else {\n            if ($errorBox) {\n                $errorBox.html(content);\n            } else {\n                Log.debug(content);\n            }\n        }\n\n        return true;\n    };\n\n    var itemcontent = function(item) {\n\n        var content = $('#boa-tpl-item')[0].innerHTML;\n        var type = (item.metadata.technical && item.metadata.technical.format) ? item.metadata.technical.format : '';\n\n        content = content.replace(/{thumb}/g, item.thumb);\n        content = content.replace(/{title}/g, item.metadata.general.title.none);\n        content = content.replace(/{about}/g, item.about);\n        content = content.replace(/{description}/g, item.metadata.general.description.none);\n        content = content.replace(/{comments}/g, item.social.comments);\n        content = content.replace(/{score}/g, item.social.score.count ? item.social.score.sum + '/' + item.social.score.count : 0);\n        content = content.replace(/{views}/g, item.social.views);\n        content = content.replace(/{type}/g, type);\n\n        return content;\n    };\n\n    /**\n     * Load strings from server.\n     */\n    var loadStrings = function() {\n\n        strings.forEach(one => {\n            s[one.key] = one.key;\n        });\n\n        Str.get_strings(strings).then(function(results) {\n            var pos = 0;\n            strings.forEach(one => {\n                s[one.key] = results[pos];\n                pos++;\n            });\n            return true;\n        }).fail(function(e) {\n            Log.debug('Error loading strings');\n            Log.debug(e);\n        });\n    };\n    // End of Load strings.\n\n    /**\n     * Initialise all for the block.\n     *\n     * @param {string} blockid The block id.\n     * @param {array} boauri The BoA API URI.\n     * @param {int} pagesize The number of items to show.\n     * @param {array} socialnetworks The social networks to share.\n     */\n    var init = function(blockid, boauri, pagesize, socialnetworks) {\n\n        pagesize = pagesize ? pagesize : 10;\n\n        loadStrings();\n\n        $('#' + blockid).each(function() {\n            var $thisblock = $(this);\n            var $searchResult = $thisblock.find('[data-control=\"search-result\"]');\n            var $boaSearch = $thisblock.find('[data-control=\"search-text\"]');\n\n            $errorBox = $thisblock.find('[data-control=\"errors-box\"]');\n\n            $thisblock.find('[data-control=\"search-button\"]').on('click', function() {\n                $thisblock.find('> .search-result').empty();\n                $boaSearch.boasearch('restart');\n                $boaSearch.boasearch('search');\n            });\n\n            $boaSearch.boasearch({\n                apiuri: boauri[0],\n                catalogues: [],\n                filters: [],\n                options: {\n                    cacheLife: 2000,\n                    resultsSize: pagesize\n                },\n                events: {\n                    onstart: function(more) {\n                        $searchResult.addClass('loading');\n                        $searchResult.show();\n\n                        if (!more) {\n                            $searchResult.find('> .boa-content').empty();\n                        }\n                    },\n                    onfound: function(data, start) {\n\n                        $searchResult.removeClass('loading');\n                        var $target = $searchResult.find('> .boa-content');\n\n                        var resultsSize = $boaSearch.boasearch('option', 'resultsSize');\n\n                        if (data.length === 0 || data.length < resultsSize) {\n                            $searchResult.find('> button').hide();\n                        } else {\n                            $searchResult.find('> button').show();\n                        }\n\n                        if (start == 0) {\n                            $thisblock.find('[data-control=\"show-one\"]').empty();\n                        }\n\n                        if ((!data || data.length === 0) && start == 0) {\n                            $target.empty();\n\n                            var content = showmessage(s.noresultsfound, 'error', '', true);\n\n                            $target.append(content);\n                            return;\n                        }\n\n                        $.each(data, function(k, item) {\n                            if (item.manifest.conexion_type == 'external') {\n                                item.finaluri = item.manifest.url;\n                            } else {\n                                item.finaluri = item.about + '/!/';\n\n                                if (item.manifest.entrypoint) {\n                                    item.finaluri += item.manifest.entrypoint;\n                                }\n                            }\n\n                            item.thumb = $boaSearch.boasearch('choosePreview', item);\n\n                            var $item = $(itemcontent(item));\n                            $item.appendTo($target);\n\n                            $item.find('[boa-href]').on('click', function() {\n                                var $this = $(this);\n\n                                var modalresource = $this.data('modal');\n\n                                if (modalresource) {\n                                    modalresource.show();\n                                    return;\n                                }\n\n                                var request = $.get($this.attr('boa-href'))\n                                    .then(function(data) {\n\n                                        data.custom = {};\n                                        data.custom.preview = chooseview(data);\n                                        data.custom.type = (data.metadata.technical && data.metadata.technical.format) ?\n                                                                data.metadata.technical.format : '';\n                                        data.custom.score = 'avg' in data.social.score ?\n                                                                data.social.score.avg + ' / ' + data.social.score.count : 0;\n                                        data.custom.downloadable = isdownloadable(data);\n\n                                        var socialnetworksitems = [];\n                                        $.each(socialnetworks, function(i, v) {\n                                            var url = v.url.replace('{url}', encodeURI(data.about + '/!/'));\n                                            url = url.replace('{name}', data.metadata.general.title.none);\n\n                                            var item = {};\n                                            item.url = url;\n                                            item.icon = v.icon;\n                                            socialnetworksitems.push(item);\n                                        });\n\n                                        data.custom.socialnetworks = socialnetworksitems;\n\n                                        if (typeof data.metadata.general.keywords.none == 'object') {\n                                            data.metadata.general.keywords.none = data.metadata.general.keywords.none.join(', ');\n                                        }\n\n                                        var template = Templates.render('mod_boa/viewresource', data)\n                                            .then(function(html) {\n                                                modalresource.setTitle(data.metadata.general.title.none);\n\n                                                var $html = $(html);\n\n                                                return $html;\n                                            })\n                                            .reject(function(error) {\n                                                Log.debug(error);\n                                            });\n\n                                        return template.promise();\n                                    }\n                                );\n\n                                ModalFactory.create({\n                                    body: request.promise()\n                                })\n                                .then(function(modal) {\n                                    modalresource = modal;\n                                    modal.getModal().addClass('block_boasearch-modal');\n                                    modal.show();\n\n                                    var root = modal.getRoot();\n                                    root.on(ModalEvents.hidden, function() {\n\n                                        // Stop audio and video when close the window.\n                                        $(modal.getBody()).find('video').each(function() {\n                                            this.pause();\n                                        });\n\n                                        $(modal.getBody()).find('audio').each(function() {\n                                            this.pause();\n                                        });\n\n                                        $(modal.getBody()).find('iframe').each(function() {\n                                            let $iframe = $(this);\n                                            $iframe.attr('src', 'about:blank');\n                                            $this.data('modal', null);\n                                        });\n                                    });\n\n                                    $this.data('modal', modalresource);\n\n                                    return true;\n                                });\n\n                            });\n                        });\n                    },\n                    onerror: function(error) {\n                        var $target = $errorBox;\n                        $target.empty();\n\n                        var $node = showmessage(error.message, 'error', error.info, true);\n                        $target.append($node);\n\n                        $node.find('button.close').on('click', function() {\n                            $node.remove();\n                        });\n\n                        Log.debug(error);\n\n                        $target.removeClass('loading');\n                    }\n                }\n            });\n\n            $searchResult.find('> button').on('click', function() {\n                $boaSearch.boasearch('nextsearch');\n            });\n\n        });\n\n    };\n\n    return {\n        init: init\n    };\n});\n"],"names":["define","$","ModalFactory","ModalEvents","Templates","Str","Log","$errorBox","strings","key","component","s","boasearch","el","params","$boasearchBox","$boasearch","$boasearchSuggestions","cacheResults","requestObjects","startRecord","wrap","parent","append","customReset","empty","hide","data","options","extend","defaults","events","results","conf","attr","methods","init","apiuri","txt","level","debug","on","event","keyCode","preventDefault","previousItemMarkup","nextItemMarkup","val","specialKeys","length","indexOf","minLetters","printSuggestions","search","window","setTimeout","getItemMarkup","item","query","text","highlightString","$item","$this","this","str","n","toLowerCase","before","substr","word","after","newposition","$current","find","index","removeClass","$new","children","eq","addClass","printItemsMarkup","title","each","k","show","initSearch","onstart","target","printResultSearch","onfound","$target","$html","preview","choosePreview","about","metadata","general","none","description","manifest","entrypoint","alternatebase","id","alterpath","alternate","request","abort","uri","suggestionsSize","filters","join","filter","get","sort","a","b","size","currentTime","Date","now","timeQuery","cacheLife","resultsSize","value","m","meta","ajax","url","dataType","success","error","onerror","xhr","responseText","parseJSON","fail","searchMore","restart","catalogues","template","fn","paramval","undefined","showmessage","type","info","asreturn","content","innerHTML","replace","html","blockid","boauri","pagesize","socialnetworks","forEach","one","get_strings","then","pos","e","$thisblock","$searchResult","$boaSearch","more","start","conexion_type","finaluri","thumb","technical","format","social","comments","score","count","sum","views","itemcontent","appendTo","modalresource","custom","$res","$reslink","outerHTML","match","src","name","test","customicon","chooseview","avg","downloadable","isdownloadable","socialnetworksitems","i","v","encodeURI","icon","push","keywords","render","setTitle","reject","promise","create","body","modal","getModal","getRoot","hidden","getBody","pause","noresultsfound","$node","message","remove"],"mappings":"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"}