{"version":3,"file":"main.min.js","sources":["../src/main.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * JS to connect with BoA repositories.\n *\n * @module     mod_boa/main\n * @copyright  2024 David Herney @ BambuCo\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(['jquery',\n        'core/modal_factory',\n        'core/modal_events',\n        'core/templates',\n        'core/log',\n        'core/ajax',\n        'mod_boa/util'],\n    function($,\n            ModalFactory,\n            ModalEvents,\n            Templates,\n            Log,\n            Ajax,\n            BoAUtil) {\n\n    var $errorBox = null;\n\n    var global = {\n        selected: []\n    };\n\n    // Load strings.\n    var strings = [\n        {key: 'noresultsfound', component: 'mod_boa'},\n        {key: 'removeselected', component: 'mod_boa'},\n        {key: 'saved', component: 'mod_boa'},\n        {key: 'notsaved', component: 'mod_boa'}\n    ];\n    var s = [];\n\n    $.boasearch = function(el, params) {\n        var $boasearch = $(el);\n        var $boasearchBox;\n        var $boasearchSuggestions = $('<ul class=\"boasearch-suggestions\"></ul>');\n        var cacheResults = [];\n        var requestObjects = [];\n        var startRecord = 0;\n\n        $boasearch.wrap('<span class=\"boasearch-box\"></span>');\n\n        $boasearchBox = $boasearch.parent();\n        $boasearchBox.append($boasearchSuggestions);\n\n        $boasearchSuggestions.customReset = function() {\n            $boasearchSuggestions.empty();\n            $boasearchSuggestions.hide();\n            $boasearchSuggestions.data('off', true);\n        };\n\n        $boasearchSuggestions.customReset();\n\n        if (params.options) {\n            params.options = $.extend({}, $.boasearch.defaults.options, params.options);\n        }\n\n        if (params.events) {\n            params.events = $.extend({}, $.boasearch.defaults.events, params.events);\n        }\n\n        if (params.results) {\n            params.results = $.extend({}, $.boasearch.defaults.results, params.results);\n        }\n\n        $boasearch.conf = $.extend({}, $.boasearch.defaults, params);\n\n        $boasearch.attr('autocomplete', 'off');\n\n        var ferror = function(txt, level) {\n            switch (level) {\n                case 'dev':\n                    if ($boasearch.conf.debug) {\n                        Log.debug('BoASearch - ' + txt);\n                    }\n                break;\n                default:\n                    Log.debug('BoASearch - ' + txt);\n            }\n        };\n\n        // Store a reference to the BoASearch object.\n        $.data(el, \"boasearch\", $boasearch);\n\n        // Private methods.\n        var methods = {\n            init: function() {\n                if (!$boasearch.conf.apiuri) {\n                    ferror('Configuration error: You need set the API URI.');\n                    return;\n                }\n\n                $boasearch.on('keypress', function(event) {\n                    if (event.keyCode) {\n                        switch (event.keyCode) {\n                            case 13: // Enter\n                                event.preventDefault();\n                                $boasearchSuggestions.customReset();\n                                break;\n                            case 27: // Escape\n                                $boasearchSuggestions.customReset();\n                                break;\n                            case 38: // Up\n                                if (!$boasearchSuggestions.data('off')) {\n                                    methods.previousItemMarkup();\n                                }\n                                break;\n                            case 40: // Down\n                                if (!$boasearchSuggestions.data('off')) {\n                                    methods.nextItemMarkup();\n                                }\n                                break;\n                        }\n                    }\n                });\n\n                $boasearch.on('keyup', function(event) {\n                    var val = $boasearch.val();\n\n                    var specialKeys = [13, 16, 17, 18, 27, 33, 34, 35, 36, 37, 38, 39, 45, 144];\n                    if (!$boasearchSuggestions.data('off')) {\n                        specialKeys[specialKeys.length] = 40;\n                    }\n\n                    if (event.keyCode && specialKeys.indexOf(event.keyCode) == -1) {\n                        if (val.length >= $boasearch.conf.options.minLetters) {\n                            $boasearch.printSuggestions(val);\n                        } else {\n                            $boasearchSuggestions.customReset();\n                        }\n                    } else if (event.keyCode === 13) {\n                        $boasearch.search();\n                    }\n                });\n\n                $boasearchBox.on('focusout', function() {\n                    window.setTimeout(function() {\n                        $boasearchSuggestions.customReset();\n                    }, 100);\n                });\n            },\n\n            /**\n             * Build a suggestion item\n             *\n             * @param {object} item the current item data to render\n             * @param {string} query the last query submited to the server.\n             */\n            getItemMarkup: function(item, query) {\n                var text = item.query != '' ? methods.highlightString(item.query, query) : '';\n\n                var $item = $('<li>' + text + '</li>');\n\n                $item.on('click', function() {\n                    var $this = $(this);\n                    $boasearchSuggestions.customReset();\n                    $boasearch.val($this.text());\n                });\n\n                return $item;\n            },\n\n            highlightString: function(str, query) {\n                var n = str.toLowerCase().indexOf(query.toLowerCase());\n                if (n >= 0) {\n                    var before = str.substr(0, n);\n                    var word = str.substr(n, query.length);\n                    var after = str.substr(n + query.length);\n\n                    str = before + '<em>' + word + '</em>' + after;\n                }\n                return str;\n            },\n\n            nextItemMarkup: function() {\n                var $current = $boasearchSuggestions.find('.current');\n                var oldposition, newposition;\n\n                if ($current.length < 1) {\n                    oldposition = -1;\n                } else {\n                    oldposition = $current.index();\n                }\n\n                newposition = oldposition + 1;\n\n                if ($boasearchSuggestions.find('> li').length <= newposition) {\n                    newposition = 0;\n                }\n\n                $current.removeClass('current');\n                var $new = $boasearchSuggestions.children().eq(newposition);\n\n                $new.addClass('current');\n                $boasearch.val($new.text());\n            },\n\n            previousItemMarkup: function() {\n                var $current = $boasearchSuggestions.find('.current');\n                var oldposition, newposition;\n\n                if ($current.length < 1) {\n                    oldposition = -1;\n                } else {\n                    oldposition = $current.index();\n                }\n\n                newposition = oldposition - 1;\n\n                if (newposition < 0) {\n                    newposition = $boasearchSuggestions.find('> li').length - 1;\n                }\n\n                $current.removeClass('current');\n                var $new = $boasearchSuggestions.children().eq(newposition);\n\n                $new.addClass('current');\n                $boasearch.val($new.text());\n            },\n\n            printItemsMarkup: function(title, data, query) {\n\n                if (data.length > 0) {\n                    $.each(data, function(k, item) {\n                        var $item = methods.getItemMarkup(item, query, k);\n                        $boasearchSuggestions.append($item);\n                    });\n\n                    $boasearchSuggestions.show();\n                    $boasearchSuggestions.data('off', false);\n                }\n            },\n\n            initSearch: function() {\n                if (typeof $boasearch.conf.events.onstart == 'function') {\n                    $boasearch.conf.events.onstart(startRecord > 0);\n                } else {\n                    if ($boasearch.conf.results.target) {\n                        $($boasearch.conf.results.target).addClass('loading');\n                        if (startRecord === 0) {\n                            $($boasearch.conf.results.target).empty();\n                        }\n                    }\n                }\n            },\n\n            printResultSearch: function(data) {\n\n                if (typeof $boasearch.conf.events.onfound == 'function') {\n                    $boasearch.conf.events.onfound(data, startRecord);\n                } else {\n                    if ($boasearch.conf.results.target) {\n                        var $target = $($boasearch.conf.results.target);\n                        $target.removeClass('loading');\n\n                        $.each(data, function(k, item) {\n                            var $html = $('<div class=\"boa-video\"></div>');\n                            var preview = BoAUtil.choosePreview(item);\n                            $html.append('<a href=\"' + item.about + '\"><h5>' + item.metadata.general.title.none + '</h5></a>');\n                            $html.append('<a href=\"' + item.about + '\"><img src=\"' + preview + '.img\" /></a>');\n                            $html.append('<p>' + item.metadata.general.description.none + '</p>');\n\n                            $target.append($html);\n                        });\n                    }\n                }\n            }\n\n        };\n\n        // Public methods\n        $boasearch.printSuggestions = function(query) {\n\n            for (var request in requestObjects) {\n                if (request && typeof request === 'object') {\n                    request.abort();\n                }\n            }\n\n            $boasearchSuggestions.customReset();\n            requestObjects = [];\n\n            var uri = $boasearch.conf.apiuri;\n            uri = uri.substr(0, uri.indexOf('/resources'));\n            uri += '/queries.json';\n\n            var params = {\n                \"q\": query,\n                \"(n)\": $boasearch.conf.options.suggestionsSize\n            };\n\n            if ($boasearch.conf.filters.length > 0) {\n                var filters = $boasearch.conf.filters.join(' AND ');\n                params.filter = filters;\n            }\n\n            // Not for specific catalogues yet.\n            var cataloguename = '';\n            requestObjects[requestObjects.length] = $.get(uri, params, function(data) {\n\n                if (data.length > 0) {\n                    data.sort(function(a, b) {\n                        return b.size - a.size;\n                    });\n\n                    methods.printItemsMarkup(cataloguename, data, query);\n                }\n            });\n        };\n\n        $boasearch.search = function() {\n\n            var currentTime = Date.now();\n\n            var query = $boasearch.val();\n\n            if (query.length < $boasearch.conf.options.minLetters) {\n                return false;\n            }\n\n            methods.initSearch();\n\n            if (cacheResults[query] && cacheResults[query].timeQuery > (currentTime - $boasearch.conf.options.cacheLife)) {\n                methods.printResultSearch(cacheResults[query].data);\n                return true;\n            }\n\n            cacheResults[query] = {\n                timeQuery: currentTime,\n                data: []\n            };\n\n            var params = {\n                \"q\": query,\n                \"(n)\": $boasearch.conf.options.resultsSize,\n                \"(s)\": startRecord\n            };\n\n            if ($boasearch.conf.filters.length > 0) {\n                $.each($boasearch.conf.filters, function(k, filter) {\n                    if (typeof filter.value == 'object') {\n                        $.each(filter.value, function(m, val) {\n                            params['(meta)[' + filter.meta + '][' + m + ']'] = val;\n                        });\n                    } else {\n                        params['(meta)[' + filter.meta + ']'] = filter.value;\n                    }\n                });\n            }\n\n            $.ajax({\n                url: $boasearch.conf.apiuri,\n                data: params,\n                dataType: 'json',\n                success: function(data) {\n                    $boasearchSuggestions.empty();\n\n                    if (typeof data === 'object' && data.error) {\n                        $boasearch.conf.events.onerror(data);\n                        data = [];\n                    }\n\n                    if (data.length > 0) {\n                        data.sort(function(a, b) {\n                            return b.size - a.size;\n                        });\n\n                        cacheResults[query].data = data;\n\n                    }\n\n                    methods.printResultSearch(data);\n                },\n                error: function(xhr) {\n                    var data = xhr.responseText;\n                    $boasearch.conf.events.onerror($.parseJSON(data));\n                },\n                fail: function(xhr) {\n                    var data = xhr.responseText;\n                    $boasearch.conf.events.onerror($.parseJSON(data));\n                }\n            });\n\n            return true;\n\n        };\n\n        $boasearch.searchMore = function() {\n            startRecord += $boasearch.conf.options.resultsSize;\n            $boasearch.search();\n        };\n\n        $boasearch.restart = function() {\n            startRecord = 0;\n        };\n\n        // BoA: Initialize.\n        methods.init();\n    };\n\n    // BoA: Default Settings.\n    $.boasearch.defaults = {\n        apiuri: null,\n        catalogues: [],\n        filters: [],\n        options: {\n            suggestionsSize: 10,\n            resultsSize: 10,\n            minLetters: 3,\n            cacheLife: 60000 // 60 seconds\n        },\n        debug: false,\n        results: {\n            target: null,\n            template: null\n        },\n        events: {\n            onstart: null,\n            onfound: null,\n            onerror: function(error) {\n                Log.debug('BoASearch - search error');\n                Log.debug(error);\n                return true;\n            }\n        }\n    };\n\n    // BoA: Plugin Function.\n    $.fn.boasearch = function(params, paramval) {\n        if (params === undefined) {\n            params = {};\n        }\n\n        if (typeof params === \"object\") {\n            return this.each(function() {\n                new $.boasearch(this, params);\n            });\n        } else {\n\n            var $boasearch = null;\n\n            if ('data' in this) {\n                $boasearch = this.data('boasearch');\n            } else {\n\n                if ('data' in $(this)) {\n                    $boasearch = $(this).data('boasearch');\n                }\n            }\n\n            if ($boasearch) {\n\n                switch (params) {\n                    case \"search\": $boasearch.search(); break;\n                    case \"nextsearch\": $boasearch.searchMore(); break;\n                    case \"option\": return $boasearch.conf.options[paramval];\n                    case \"restart\": $boasearch.restart(); break;\n                    case \"choosePreview\": return BoAUtil.choosePreview(paramval);\n                }\n            } else {\n                Log.debug('Error in boasearch object');\n            }\n        }\n\n        return true;\n    };\n\n    var binditem = function($item) {\n\n        $item.find('[boa-href]').on('click', function() {\n            var $this = $(this);\n\n            var modalresource = $this.data('modal');\n\n            if (modalresource) {\n                modalresource.show();\n                return;\n            }\n\n            var request = $.get($this.attr('boa-href'))\n                .then(function(data) {\n\n                    data.custom = {};\n                    data.custom.preview = BoAUtil.chooseView(data);\n                    data.custom.type = (data.metadata.technical && data.metadata.technical.format) ?\n                                            data.metadata.technical.format : '';\n                    data.custom.score = 'avg' in data.social.score ?\n                                            data.social.score.avg + ' / ' + data.social.score.count : 0;\n                    data.custom.downloadable = BoAUtil.isDownloadable(data);\n                    data.about = encodeURI(data.about);\n\n                    var socialnetworksitems = [];\n                    $.each(global.socialnetworks, function(i, v) {\n                        var url = v.url.replace('{url}', encodeURI(data.about + '/!/'));\n                        url = url.replace('{name}', data.metadata.general.title.none);\n\n                        var item = {};\n                        item.url = url;\n                        item.icon = v.icon;\n                        socialnetworksitems.push(item);\n                    });\n\n                    data.custom.socialnetworks = socialnetworksitems;\n\n                    if (typeof data.metadata.general.keywords.none == 'object') {\n                        data.metadata.general.keywords.none = data.metadata.general.keywords.none.join(', ');\n                    }\n\n                    return Templates.render('mod_boa/viewresource', data);\n                })\n                .then(function(html) {\n\n                    var $html = $(html);\n                    $html.find('[data-addtoselection]').on('click', function() {\n                        var $thisobject = $(this);\n\n                        if (global.selected[$thisobject.data('addtoselection')]) {\n                            global.selected[$thisobject.data('addtoselection')].detach();\n                            delete global.selected[$thisobject.data('addtoselection')];\n                        } else {\n                            global.selected[$thisobject.data('addtoselection')] = $item;\n                            $thisobject.removeClass('btn-primary').addClass('btn-danger');\n                            $thisobject.find('span').html(s.removeselected);\n                            refreshadded();\n                        }\n                        $this.data('modal').hide();\n                    });\n\n                    return $html;\n                })\n                .catch(function(error) {\n                    Log.debug(error);\n                });\n\n            ModalFactory.create({\n                body: request.promise()\n            })\n            .then(function(modal) {\n                modalresource = modal;\n\n                if ($item.data('metadata')) {\n                    let itemdata = $item.data('metadata');\n                    modalresource.setTitle(itemdata.metadata.general.title.none);\n                }\n                modal.getModal().addClass('block_boasearch-modal');\n                modal.show();\n\n                var root = modal.getRoot();\n                root.on(ModalEvents.hidden, function() {\n\n                    // Stop audio and video when close the window.\n                    $(modal.getBody()).find('video').each(function() {\n                        this.pause();\n                    });\n\n                    $(modal.getBody()).find('audio').each(function() {\n                        this.pause();\n                    });\n\n                    $(modal.getBody()).find('iframe').each(function() {\n                        let $iframe = $(this);\n                        $iframe.attr('src', 'about:blank');\n                        $this.data('modal', null);\n                    });\n                });\n\n                $this.data('modal', modalresource);\n\n                return true;\n            })\n            .catch(function(error) {\n                Log.debug(error);\n            });\n\n        });\n\n    };\n\n    var refreshadded = function(change = true) {\n\n        var $container = $('#boa-currentselection > div.boa-items');\n        $container.children().detach();\n        $('#boa-currentselection > .alert').detach();\n\n        if (change) {\n            $('#boa-currentselection .boa-saveselection').show();\n        }\n\n        if (!global.selected) {\n            return;\n        }\n\n        for (var about in global.selected) {\n            let $item = global.selected[about];\n\n            if ($item) {\n                $container.append($item);\n                continue;\n            }\n\n            $.get(about)\n                .then(function(data) {\n                    data.thumb = BoAUtil.choosePreview(data);\n\n                    var $item = $(BoAUtil.itemContent(data));\n                    binditem($item);\n                    $item.data('metadata', data);\n                    global.selected[data.about] = $item;\n                    $container.append($item);\n                    return true;\n                })\n                .fail(function(e) {\n                    Log.debug('Error loading resource');\n                    Log.debug(e);\n                });\n\n        }\n    };\n\n    /**\n     * Initialise all for the block.\n     *\n     * @param {string} blockid The block id.\n     * @param {int} cmid The course module id.\n     * @param {array} boauri The BoA API URI.\n     * @param {int} pagesize The number of items to show.\n     * @param {array} socialnetworks The social networks to share.\n     */\n    var init = function(blockid, cmid, boauri, pagesize, socialnetworks) {\n\n        pagesize = pagesize ? pagesize : 10;\n        global.socialnetworks = socialnetworks;\n\n        // The variable \"boacurrentselection\" comes from the template because it can be so large that it cannot be passed\n        // by parameters since it exceeds the limit for these values.\n        $.each(M.boacurrentselection, function(index, uri) {\n            global.selected[uri] = null;\n        });\n\n        s = BoAUtil.loadStrings(strings);\n\n        $('#' + blockid).each(function() {\n            var $thisblock = $(this);\n            var $searchResult = $thisblock.find('[data-control=\"search-result\"]');\n            var $boaSearch = $thisblock.find('[data-control=\"search-text\"]');\n\n            $errorBox = $thisblock.find('[data-control=\"errors-box\"]');\n\n            $thisblock.find('[data-control=\"search-button\"]').on('click', function() {\n                $thisblock.find('> .search-result').empty();\n                $boaSearch.boasearch('restart');\n                $boaSearch.boasearch('search');\n            });\n\n            $boaSearch.boasearch({\n                apiuri: boauri[0],\n                catalogues: [],\n                filters: [],\n                options: {\n                    cacheLife: 2000,\n                    resultsSize: pagesize\n                },\n                events: {\n                    onstart: function(more) {\n                        $searchResult.addClass('loading');\n                        $searchResult.show();\n\n                        if (!more) {\n                            $searchResult.find('> .boa-content').empty();\n                        }\n                    },\n                    onfound: function(data, start) {\n\n                        $searchResult.removeClass('loading');\n                        var $target = $searchResult.find('> .boa-content');\n\n                        var resultsSize = $boaSearch.boasearch('option', 'resultsSize');\n\n                        if (data.length === 0 || data.length < resultsSize) {\n                            $searchResult.find('> button').hide();\n                        } else {\n                            $searchResult.find('> button').show();\n                        }\n\n                        if (start == 0) {\n                            $thisblock.find('[data-control=\"show-one\"]').empty();\n                        }\n\n                        if ((!data || data.length === 0) && start == 0) {\n                            $target.empty();\n\n                            var content = BoAUtil.showMessage(s.noresultsfound);\n\n                            $target.append(content);\n                            return;\n                        }\n\n                        $.each(data, function(k, item) {\n\n                            // Check if the item is already selected.\n                            if (global.selected[item.about]) {\n                                return;\n                            }\n\n                            if (item.manifest.conexion_type == 'external') {\n                                item.finaluri = item.manifest.url;\n                            } else {\n                                item.finaluri = item.about + '/!/';\n\n                                if (item.manifest.entrypoint) {\n                                    item.finaluri += item.manifest.entrypoint;\n                                }\n                            }\n\n                            item.thumb = BoAUtil.choosePreview(item);\n\n                            var $item = $(BoAUtil.itemContent(item));\n                            $item.data('metadata', item);\n                            $item.appendTo($target);\n\n                            binditem($item);\n                        });\n                    },\n                    onerror: function(error) {\n                        var $target = $errorBox;\n                        $target.empty();\n\n                        var $node = BoAUtil.showMessage(error.message, 'error', error.info);\n                        $target.append($node);\n\n                        Log.debug(error);\n\n                        $target.removeClass('loading');\n                    }\n                }\n            });\n\n            $searchResult.find('> button').on('click', function() {\n                $boaSearch.boasearch('nextsearch');\n            });\n\n        });\n\n        var $saveselection = $('#boa-currentselection .boa-saveselection');\n        $saveselection.hide();\n        $saveselection.on('click', function() {\n            var $thisbutton = $(this);\n\n            var data = [];\n            for (var about in global.selected) {\n                data.push(about);\n            }\n\n            Ajax.call([{\n                methodname: 'mod_boa_select_resources',\n                args: {\n                    cmid: cmid,\n                    list: data\n                }\n            }])[0].then(function(data) {\n\n                if (data) {\n                    let $msg = BoAUtil.showMessage(s.saved, 'success');\n                    $saveselection.after($msg);\n                } else {\n                    let $msg = BoAUtil.showMessage(s.notsaved);\n                    $saveselection.after($msg);\n                }\n\n                $thisbutton.hide();\n\n                return true;\n            }).fail(function(e) {\n                Log.debug('Error saving resources selected');\n                Log.debug(e);\n            });\n        });\n\n        refreshadded(false);\n    };\n\n    return {\n        init: init\n    };\n});\n"],"names":["define","$","ModalFactory","ModalEvents","Templates","Log","Ajax","BoAUtil","$errorBox","global","selected","strings","key","component","s","boasearch","el","params","$boasearchBox","$boasearch","$boasearchSuggestions","cacheResults","requestObjects","startRecord","wrap","parent","append","customReset","empty","hide","data","options","extend","defaults","events","results","conf","attr","methods","init","apiuri","txt","level","debug","on","event","keyCode","preventDefault","previousItemMarkup","nextItemMarkup","val","specialKeys","length","indexOf","minLetters","printSuggestions","search","window","setTimeout","getItemMarkup","item","query","text","highlightString","$item","$this","this","str","n","toLowerCase","before","substr","word","after","newposition","$current","find","index","removeClass","$new","children","eq","addClass","printItemsMarkup","title","each","k","show","initSearch","onstart","target","printResultSearch","onfound","$target","$html","preview","choosePreview","about","metadata","general","none","description","request","abort","uri","suggestionsSize","filters","join","filter","get","sort","a","b","size","currentTime","Date","now","timeQuery","cacheLife","resultsSize","value","m","meta","ajax","url","dataType","success","error","onerror","xhr","responseText","parseJSON","fail","searchMore","restart","catalogues","template","fn","paramval","undefined","binditem","modalresource","then","custom","chooseView","type","technical","format","score","social","avg","count","downloadable","isDownloadable","encodeURI","socialnetworksitems","socialnetworks","i","v","replace","icon","push","keywords","render","html","$thisobject","detach","removeselected","refreshadded","catch","create","body","promise","modal","itemdata","setTitle","getModal","getRoot","hidden","getBody","pause","change","$container","thumb","itemContent","e","blockid","cmid","boauri","pagesize","M","boacurrentselection","loadStrings","$thisblock","$searchResult","$boaSearch","more","start","manifest","conexion_type","finaluri","entrypoint","appendTo","content","showMessage","noresultsfound","$node","message","info","$saveselection","$thisbutton","call","methodname","args","list","$msg","saved","notsaved"],"mappings":"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"}