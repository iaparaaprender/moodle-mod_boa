{"version":3,"file":"main.min.js","sources":["../src/main.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * JS to connect with BoA repositories.\n *\n * @module     mod_boa/main\n * @copyright  2024 David Herney @ BambuCo\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(['jquery',\n        'core/modal_factory',\n        'core/modal_events',\n        'core/templates',\n        'core/str',\n        'core/log',\n        'core/ajax'],\n    function($,\n            ModalFactory,\n            ModalEvents,\n            Templates,\n            Str,\n            Log,\n            Ajax) {\n\n    var $errorBox = null;\n\n    var global = {\n        selected: []\n    };\n\n    // Load strings.\n    var strings = [\n        {key: 'noresultsfound', component: 'mod_boa'},\n        {key: 'removeselected', component: 'mod_boa'},\n        {key: 'saved', component: 'mod_boa'},\n        {key: 'notsaved', component: 'mod_boa'}\n    ];\n    var s = [];\n\n    $.boasearch = function(el, params) {\n        var $boasearch = $(el);\n        var $boasearchBox;\n        var $boasearchSuggestions = $('<ul class=\"boasearch-suggestions\"></ul>');\n        var cacheResults = [];\n        var requestObjects = [];\n        var startRecord = 0;\n\n        $boasearch.wrap('<span class=\"boasearch-box\"></span>');\n\n        $boasearchBox = $boasearch.parent();\n        $boasearchBox.append($boasearchSuggestions);\n\n        $boasearchSuggestions.customReset = function() {\n            $boasearchSuggestions.empty();\n            $boasearchSuggestions.hide();\n            $boasearchSuggestions.data('off', true);\n        };\n\n        $boasearchSuggestions.customReset();\n\n        if (params.options) {\n            params.options = $.extend({}, $.boasearch.defaults.options, params.options);\n        }\n\n        if (params.events) {\n            params.events = $.extend({}, $.boasearch.defaults.events, params.events);\n        }\n\n        if (params.results) {\n            params.results = $.extend({}, $.boasearch.defaults.results, params.results);\n        }\n\n        $boasearch.conf = $.extend({}, $.boasearch.defaults, params);\n\n        $boasearch.attr('autocomplete', 'off');\n\n        var ferror = function(txt, level) {\n            switch (level) {\n                case 'dev':\n                    if ($boasearch.conf.debug) {\n                        Log.debug('BoASearch - ' + txt);\n                    }\n                break;\n                default:\n                    Log.debug('BoASearch - ' + txt);\n            }\n        };\n\n        // Store a reference to the BoASearch object.\n        $.data(el, \"boasearch\", $boasearch);\n\n        // Private methods.\n        var methods = {\n            init: function() {\n                if (!$boasearch.conf.apiuri) {\n                    ferror('Configuration error: You need set the API URI.');\n                    return;\n                }\n\n                $boasearch.on('keypress', function(event) {\n                    if (event.keyCode) {\n                        switch (event.keyCode) {\n                            case 13: // Enter\n                                event.preventDefault();\n                                $boasearchSuggestions.customReset();\n                                break;\n                            case 27: // Escape\n                                $boasearchSuggestions.customReset();\n                                break;\n                            case 38: // Up\n                                if (!$boasearchSuggestions.data('off')) {\n                                    methods.previousItemMarkup();\n                                }\n                                break;\n                            case 40: // Down\n                                if (!$boasearchSuggestions.data('off')) {\n                                    methods.nextItemMarkup();\n                                }\n                                break;\n                        }\n                    }\n                });\n\n                $boasearch.on('keyup', function(event) {\n                    var val = $boasearch.val();\n\n                    var specialKeys = [13, 16, 17, 18, 27, 33, 34, 35, 36, 37, 38, 39, 45, 144];\n                    if (!$boasearchSuggestions.data('off')) {\n                        specialKeys[specialKeys.length] = 40;\n                    }\n\n                    if (event.keyCode && specialKeys.indexOf(event.keyCode) == -1) {\n                        if (val.length >= $boasearch.conf.options.minLetters) {\n                            $boasearch.printSuggestions(val);\n                        } else {\n                            $boasearchSuggestions.customReset();\n                        }\n                    } else if (event.keyCode === 13) {\n                        $boasearch.search();\n                    }\n                });\n\n                $boasearchBox.on('focusout', function() {\n                    window.setTimeout(function() {\n                        $boasearchSuggestions.customReset();\n                    }, 100);\n                });\n            },\n\n            /**\n             * Build a suggestion item\n             *\n             * @param {object} item the current item data to render\n             * @param {string} query the last query submited to the server.\n             */\n            getItemMarkup: function(item, query) {\n                var text = item.query != '' ? methods.highlightString(item.query, query) : '';\n\n                var $item = $('<li>' + text + '</li>');\n\n                $item.on('click', function() {\n                    var $this = $(this);\n                    $boasearchSuggestions.customReset();\n                    $boasearch.val($this.text());\n                });\n\n                return $item;\n            },\n\n            highlightString: function(str, query) {\n                var n = str.toLowerCase().indexOf(query.toLowerCase());\n                if (n >= 0) {\n                    var before = str.substr(0, n);\n                    var word = str.substr(n, query.length);\n                    var after = str.substr(n + query.length);\n\n                    str = before + '<em>' + word + '</em>' + after;\n                }\n                return str;\n            },\n\n            nextItemMarkup: function() {\n                var $current = $boasearchSuggestions.find('.current');\n                var oldposition, newposition;\n\n                if ($current.length < 1) {\n                    oldposition = -1;\n                } else {\n                    oldposition = $current.index();\n                }\n\n                newposition = oldposition + 1;\n\n                if ($boasearchSuggestions.find('> li').length <= newposition) {\n                    newposition = 0;\n                }\n\n                $current.removeClass('current');\n                var $new = $boasearchSuggestions.children().eq(newposition);\n\n                $new.addClass('current');\n                $boasearch.val($new.text());\n            },\n\n            previousItemMarkup: function() {\n                var $current = $boasearchSuggestions.find('.current');\n                var oldposition, newposition;\n\n                if ($current.length < 1) {\n                    oldposition = -1;\n                } else {\n                    oldposition = $current.index();\n                }\n\n                newposition = oldposition - 1;\n\n                if (newposition < 0) {\n                    newposition = $boasearchSuggestions.find('> li').length - 1;\n                }\n\n                $current.removeClass('current');\n                var $new = $boasearchSuggestions.children().eq(newposition);\n\n                $new.addClass('current');\n                $boasearch.val($new.text());\n            },\n\n            printItemsMarkup: function(title, data, query) {\n\n                if (data.length > 0) {\n                    $.each(data, function(k, item) {\n                        var $item = methods.getItemMarkup(item, query, k);\n                        $boasearchSuggestions.append($item);\n                    });\n\n                    $boasearchSuggestions.show();\n                    $boasearchSuggestions.data('off', false);\n                }\n            },\n\n            initSearch: function() {\n                if (typeof $boasearch.conf.events.onstart == 'function') {\n                    $boasearch.conf.events.onstart(startRecord > 0);\n                } else {\n                    if ($boasearch.conf.results.target) {\n                        $($boasearch.conf.results.target).addClass('loading');\n                        if (startRecord === 0) {\n                            $($boasearch.conf.results.target).empty();\n                        }\n                    }\n                }\n            },\n\n            printResultSearch: function(data) {\n\n                if (typeof $boasearch.conf.events.onfound == 'function') {\n                    $boasearch.conf.events.onfound(data, startRecord);\n                } else {\n                    if ($boasearch.conf.results.target) {\n                        var $target = $($boasearch.conf.results.target);\n                        $target.removeClass('loading');\n\n                        $.each(data, function(k, item) {\n                            var $html = $('<div class=\"boa-video\"></div>');\n                            var preview = this.choosePreview(item);\n                            $html.append('<a href=\"' + item.about + '\"><h5>' + item.metadata.general.title.none + '</h5></a>');\n                            $html.append('<a href=\"' + item.about + '\"><img src=\"' + preview + '.img\" /></a>');\n                            $html.append('<p>' + item.metadata.general.description.none + '</p>');\n\n                            $target.append($html);\n                        });\n                    }\n                }\n            },\n\n            choosePreview: function(item) {\n\n                if ('alternate' in item.manifest && item.manifest.entrypoint) {\n\n                    var alternatebase;\n\n                    if (item.id.indexOf('/content/') >= 0) {\n                        alternatebase = item.id.substr(item.id.indexOf('/content/') + 9);\n                    } else {\n                        alternatebase = item.manifest.entrypoint;\n                    }\n\n                    var alterpath = item.about + '/!/.alternate/' + alternatebase;\n\n                    if (item.manifest.alternate.indexOf('preview.png') >= 0) {\n                        return alterpath + '/preview.png';\n                    } else if (item.manifest.alternate.indexOf('thumb.png') >= 0) {\n                        return alterpath + '/thumb.png';\n                    }\n                }\n\n                return item.about + '.img?s=128';\n            }\n        };\n\n        // Public methods\n        $boasearch.printSuggestions = function(query) {\n\n            for (var request in requestObjects) {\n                if (request && typeof request === 'object') {\n                    request.abort();\n                }\n            }\n\n            $boasearchSuggestions.customReset();\n            requestObjects = [];\n\n            var uri = $boasearch.conf.apiuri;\n            uri = uri.substr(0, uri.indexOf('/resources'));\n            uri += '/queries.json';\n\n            var params = {\n                \"q\": query,\n                \"(n)\": $boasearch.conf.options.suggestionsSize\n            };\n\n            if ($boasearch.conf.filters.length > 0) {\n                var filters = $boasearch.conf.filters.join(' AND ');\n                params.filter = filters;\n            }\n\n            // Not for specific catalogues yet.\n            var cataloguename = '';\n            requestObjects[requestObjects.length] = $.get(uri, params, function(data) {\n\n                if (data.length > 0) {\n                    data.sort(function(a, b) {\n                        return b.size - a.size;\n                    });\n\n                    methods.printItemsMarkup(cataloguename, data, query);\n                }\n            });\n        };\n\n        $boasearch.search = function() {\n\n            var currentTime = Date.now();\n\n            var query = $boasearch.val();\n\n            if (query.length < $boasearch.conf.options.minLetters) {\n                return false;\n            }\n\n            methods.initSearch();\n\n            if (cacheResults[query] && cacheResults[query].timeQuery > (currentTime - $boasearch.conf.options.cacheLife)) {\n                methods.printResultSearch(cacheResults[query].data);\n                return true;\n            }\n\n            cacheResults[query] = {\n                timeQuery: currentTime,\n                data: []\n            };\n\n            var params = {\n                \"q\": query,\n                \"(n)\": $boasearch.conf.options.resultsSize,\n                \"(s)\": startRecord\n            };\n\n            if ($boasearch.conf.filters.length > 0) {\n                $.each($boasearch.conf.filters, function(k, filter) {\n                    if (typeof filter.value == 'object') {\n                        $.each(filter.value, function(m, val) {\n                            params['(meta)[' + filter.meta + '][' + m + ']'] = val;\n                        });\n                    } else {\n                        params['(meta)[' + filter.meta + ']'] = filter.value;\n                    }\n                });\n            }\n\n            $.ajax({\n                url: $boasearch.conf.apiuri,\n                data: params,\n                dataType: 'json',\n                success: function(data) {\n                    $boasearchSuggestions.empty();\n\n                    if (typeof data === 'object' && data.error) {\n                        $boasearch.conf.events.onerror(data);\n                        data = [];\n                    }\n\n                    if (data.length > 0) {\n                        data.sort(function(a, b) {\n                            return b.size - a.size;\n                        });\n\n                        cacheResults[query].data = data;\n\n                    }\n\n                    methods.printResultSearch(data);\n                },\n                error: function(xhr) {\n                    var data = xhr.responseText;\n                    $boasearch.conf.events.onerror($.parseJSON(data));\n                },\n                fail: function(xhr) {\n                    var data = xhr.responseText;\n                    $boasearch.conf.events.onerror($.parseJSON(data));\n                }\n            });\n\n            return true;\n\n        };\n\n        $boasearch.searchMore = function() {\n            startRecord += $boasearch.conf.options.resultsSize;\n            $boasearch.search();\n        };\n\n        $boasearch.restart = function() {\n            startRecord = 0;\n        };\n\n        $boasearch.choosePreview = methods.choosePreview;\n\n        // BoA: Initialize.\n        methods.init();\n    };\n\n    // BoA: Default Settings.\n    $.boasearch.defaults = {\n        apiuri: null,\n        catalogues: [],\n        filters: [],\n        options: {\n            suggestionsSize: 10,\n            resultsSize: 10,\n            minLetters: 3,\n            cacheLife: 60000 // 60 seconds\n        },\n        debug: false,\n        results: {\n            target: null,\n            template: null\n        },\n        events: {\n            onstart: null,\n            onfound: null,\n            onerror: function(error) {\n                Log.debug('BoASearch - search error');\n                Log.debug(error);\n                return true;\n            }\n        }\n    };\n\n    // BoA: Plugin Function.\n    $.fn.boasearch = function(params, paramval) {\n        if (params === undefined) {\n            params = {};\n        }\n\n        if (typeof params === \"object\") {\n            return this.each(function() {\n                new $.boasearch(this, params);\n            });\n        } else {\n\n            var $boasearch = null;\n\n            if ('data' in this) {\n                $boasearch = this.data('boasearch');\n            } else {\n\n                if ('data' in $(this)) {\n                    $boasearch = $(this).data('boasearch');\n                }\n            }\n\n            if ($boasearch) {\n\n                switch (params) {\n                    case \"search\": $boasearch.search(); break;\n                    case \"nextsearch\": $boasearch.searchMore(); break;\n                    case \"option\": return $boasearch.conf.options[paramval];\n                    case \"restart\": $boasearch.restart(); break;\n                    case \"choosePreview\": return $boasearch.choosePreview(paramval);\n                }\n            } else {\n                Log.debug('Error in boasearch object');\n            }\n        }\n\n        return true;\n    };\n\n    var chooseview = function(data) {\n\n        var $res = null;\n\n        // If it is a external resource.\n        if (data.manifest.conexion_type && data.manifest.conexion_type == 'external') {\n            $res = $('<iframe></iframe>');\n            $res.attr('src', data.manifest.url);\n\n            var $reslink = $('<p><a target=\"_blank\"></a></p>');\n            $reslink.find('a').attr('href', data.manifest.url).html(data.manifest.url);\n\n            return $res.get(0).outerHTML + $reslink.get(0).outerHTML;\n        }\n\n        if (!data.metadata.technical || !data.metadata.technical.format) {\n            return $res;\n        }\n\n        if (data.metadata.technical.format.match(/pdf/gi) ||\n                data.metadata.technical.format.match(/html/gi) ||\n                data.metadata.technical.format.match(/tepuy/gi)) {\n            $res = $('<iframe></iframe>');\n            $res.attr('src', data.about + '/!/').attr('type', data.metadata.technical.format);\n\n            return $res.get(0).outerHTML;\n        }\n\n        var src = '';\n        var alternatebase;\n        if (data.id.indexOf('/content/') >= 0) {\n            alternatebase = data.id.substr(data.id.indexOf('/content/') + 9);\n        } else {\n            alternatebase = data.manifest.entrypoint;\n        }\n\n        if (data.manifest.alternate && data.manifest.entrypoint) {\n            var alterpath = data.about + '/!/.alternate/' + alternatebase + '/';\n            var name = '';\n\n            if (data.metadata.technical.format.match(/video/gi) ||\n                    data.metadata.technical.format.match(/audio/gi) ||\n                    data.metadata.technical.format.match(/image/gi)) {\n\n                if (typeof data.manifest.alternate == 'object') {\n                    name = data.manifest.alternate.find(e => /small/g.test(e));\n\n                    if (name) {\n                        src = alterpath + name;\n                    } else {\n                        name = data.manifest.alternate.find(e => /medium/g.test(e));\n                        src = name ? alterpath + name : data.about + '/!/' + data.manifest.entrypoint;\n                    }\n                } else {\n                    src = data.about + '/!/' + data.manifest.entrypoint;\n                }\n            } else {\n                name = typeof data.manifest.alternate == 'object' ?\n                                data.manifest.alternate.find(e => /thumb/g.test(e)) : '';\n                src = name ? alterpath + name : data.manifest.customicon;\n            }\n\n        } else {\n            if ('technical' in data.metadata && 'format' in data.metadata.technical &&\n                    (data.metadata.technical.format.match(/video/gi) ||\n                    data.metadata.technical.format.match(/audio/gi) ||\n                    data.metadata.technical.format.match(/image/gi))) {\n                src = data.about + '/!/';\n            } else {\n                src = data.manifest.customicon;\n            }\n        }\n\n        if (data.metadata.technical.format.match(/video/gi)) {\n            $res = $('<video controls><source></source></video>');\n            $res.find('source').attr('src', src).attr('type', data.metadata.technical.format);\n\n        } else if (data.metadata.technical.format.match(/audio/gi)) {\n            $res = $('<audio controls><source></source></audio>');\n            $res.find('source').attr('src', src).attr('type', data.metadata.technical.format);\n\n        } else {\n            $res = $('<img />');\n            $res.attr('src', src).attr('alt', data.metadata.general.title.none);\n        }\n\n        return $res.get(0).outerHTML;\n    };\n\n    var isdownloadable = function(data) {\n        // ToDo: validate by content type.\n        return !data.manifest.conexion_type || data.manifest.conexion_type != 'external';\n    };\n\n    var showmessage = function(text, type, info, asreturn) {\n        type = type ? type : 'error';\n        info = info ? info : '';\n\n        if (type == 'error') {\n            type = 'danger';\n        }\n\n        var content = $('#boa-tpl-error-item')[0].innerHTML;\n\n        content = content.replace(/{message}/g, text);\n        content = content.replace(/{info}/g, info);\n        content = content.replace(/{type}/g, type);\n\n        if (asreturn) {\n            return $(content);\n        } else {\n            if ($errorBox) {\n                $errorBox.html(content);\n            } else {\n                Log.debug(content);\n            }\n        }\n\n        return true;\n    };\n\n    var itemcontent = function(item) {\n\n        var content = $('#boa-tpl-item')[0].innerHTML;\n        var type = (item.metadata.technical && item.metadata.technical.format) ? item.metadata.technical.format : '';\n\n        content = content.replace(/{thumb}/g, item.thumb);\n        content = content.replace(/{title}/g, item.metadata.general.title.none);\n        content = content.replace(/{about}/g, item.about);\n        content = content.replace(/{description}/g, item.metadata.general.description.none);\n        content = content.replace(/{comments}/g, item.social.comments);\n        content = content.replace(/{score}/g, item.social.score.count ? item.social.score.sum + '/' + item.social.score.count : 0);\n        content = content.replace(/{views}/g, item.social.views);\n        content = content.replace(/{type}/g, type);\n\n        return content;\n    };\n\n    var binditem = function($item) {\n\n        $item.find('[boa-href]').on('click', function() {\n            var $this = $(this);\n\n            var modalresource = $this.data('modal');\n\n            if (modalresource) {\n                modalresource.show();\n                return;\n            }\n\n            var request = $.get($this.attr('boa-href'))\n                .then(function(data) {\n\n                    data.custom = {};\n                    data.custom.preview = chooseview(data);\n                    data.custom.type = (data.metadata.technical && data.metadata.technical.format) ?\n                                            data.metadata.technical.format : '';\n                    data.custom.score = 'avg' in data.social.score ?\n                                            data.social.score.avg + ' / ' + data.social.score.count : 0;\n                    data.custom.downloadable = isdownloadable(data);\n                    data.about = encodeURI(data.about);\n\n                    var socialnetworksitems = [];\n                    $.each(global.socialnetworks, function(i, v) {\n                        var url = v.url.replace('{url}', encodeURI(data.about + '/!/'));\n                        url = url.replace('{name}', data.metadata.general.title.none);\n\n                        var item = {};\n                        item.url = url;\n                        item.icon = v.icon;\n                        socialnetworksitems.push(item);\n                    });\n\n                    data.custom.socialnetworks = socialnetworksitems;\n\n                    if (typeof data.metadata.general.keywords.none == 'object') {\n                        data.metadata.general.keywords.none = data.metadata.general.keywords.none.join(', ');\n                    }\n\n                    return Templates.render('mod_boa/viewresource', data);\n                })\n                .then(function(html) {\n\n                    var $html = $(html);\n                    $html.find('[data-addtoselection]').on('click', function() {\n                        var $thisobject = $(this);\n\n                        if (global.selected[$thisobject.data('addtoselection')]) {\n                            global.selected[$thisobject.data('addtoselection')].detach();\n                            delete global.selected[$thisobject.data('addtoselection')];\n                        } else {\n                            global.selected[$thisobject.data('addtoselection')] = $item;\n                            $thisobject.removeClass('btn-primary').addClass('btn-danger');\n                            $thisobject.find('span').html(s.removeselected);\n                            refreshadded();\n                        }\n                        $this.data('modal').hide();\n                    });\n\n                    return $html;\n                })\n                .catch(function(error) {\n                    Log.debug(error);\n                });\n\n            ModalFactory.create({\n                body: request.promise()\n            })\n            .then(function(modal) {\n                modalresource = modal;\n\n                if ($item.data('metadata')) {\n                    let itemdata = $item.data('metadata');\n                    modalresource.setTitle(itemdata.metadata.general.title.none);\n                }\n                modal.getModal().addClass('block_boasearch-modal');\n                modal.show();\n\n                var root = modal.getRoot();\n                root.on(ModalEvents.hidden, function() {\n\n                    // Stop audio and video when close the window.\n                    $(modal.getBody()).find('video').each(function() {\n                        this.pause();\n                    });\n\n                    $(modal.getBody()).find('audio').each(function() {\n                        this.pause();\n                    });\n\n                    $(modal.getBody()).find('iframe').each(function() {\n                        let $iframe = $(this);\n                        $iframe.attr('src', 'about:blank');\n                        $this.data('modal', null);\n                    });\n                });\n\n                $this.data('modal', modalresource);\n\n                return true;\n            });\n\n        });\n\n    };\n\n    var refreshadded = function() {\n        var $container = $('#boa-currentselection > div.boa-items');\n        $container.children().detach();\n        $('#boa-currentselection > .alert').detach();\n\n        $('#boa-currentselection .boa-saveselection').show();\n\n        for (var about in global.selected) {\n            let $item = global.selected[about];\n\n            if ($item) {\n                $container.append($item);\n                continue;\n            }\n\n            $.get(about)\n                .then(function(data) {\n                    var $item = $(itemcontent(data));\n                    binditem($item);\n                    $item.data('metadata', data);\n                    global.selected[data.about] = $item;\n                    $container.append($item);\n                })\n                .fail(function(e) {\n                    Log.debug('Error loading resource');\n                    Log.debug(e);\n                });\n\n        }\n    };\n\n    /**\n     * Load strings from server.\n     */\n    var loadStrings = function() {\n\n        strings.forEach(one => {\n            s[one.key] = one.key;\n        });\n\n        Str.get_strings(strings).then(function(results) {\n            var pos = 0;\n            strings.forEach(one => {\n                s[one.key] = results[pos];\n                pos++;\n            });\n            return true;\n        }).fail(function(e) {\n            Log.debug('Error loading strings');\n            Log.debug(e);\n        });\n    };\n    // End of Load strings.\n\n    /**\n     * Initialise all for the block.\n     *\n     * @param {string} blockid The block id.\n     * @param {int} cmid The course module id.\n     * @param {array} boauri The BoA API URI.\n     * @param {int} pagesize The number of items to show.\n     * @param {array} socialnetworks The social networks to share.\n     */\n    var init = function(blockid, cmid, boauri, pagesize, socialnetworks) {\n\n        pagesize = pagesize ? pagesize : 10;\n        global.socialnetworks = socialnetworks;\n\n        loadStrings();\n\n        $('#' + blockid).each(function() {\n            var $thisblock = $(this);\n            var $searchResult = $thisblock.find('[data-control=\"search-result\"]');\n            var $boaSearch = $thisblock.find('[data-control=\"search-text\"]');\n\n            $errorBox = $thisblock.find('[data-control=\"errors-box\"]');\n\n            $thisblock.find('[data-control=\"search-button\"]').on('click', function() {\n                $thisblock.find('> .search-result').empty();\n                $boaSearch.boasearch('restart');\n                $boaSearch.boasearch('search');\n            });\n\n            $boaSearch.boasearch({\n                apiuri: boauri[0],\n                catalogues: [],\n                filters: [],\n                options: {\n                    cacheLife: 2000,\n                    resultsSize: pagesize\n                },\n                events: {\n                    onstart: function(more) {\n                        $searchResult.addClass('loading');\n                        $searchResult.show();\n\n                        if (!more) {\n                            $searchResult.find('> .boa-content').empty();\n                        }\n                    },\n                    onfound: function(data, start) {\n\n                        $searchResult.removeClass('loading');\n                        var $target = $searchResult.find('> .boa-content');\n\n                        var resultsSize = $boaSearch.boasearch('option', 'resultsSize');\n\n                        if (data.length === 0 || data.length < resultsSize) {\n                            $searchResult.find('> button').hide();\n                        } else {\n                            $searchResult.find('> button').show();\n                        }\n\n                        if (start == 0) {\n                            $thisblock.find('[data-control=\"show-one\"]').empty();\n                        }\n\n                        if ((!data || data.length === 0) && start == 0) {\n                            $target.empty();\n\n                            var content = showmessage(s.noresultsfound, 'error', '', true);\n\n                            $target.append(content);\n                            return;\n                        }\n\n                        $.each(data, function(k, item) {\n\n                            // Check if the item is already selected.\n                            if (global.selected[item.about]) {\n                                return;\n                            }\n\n                            if (item.manifest.conexion_type == 'external') {\n                                item.finaluri = item.manifest.url;\n                            } else {\n                                item.finaluri = item.about + '/!/';\n\n                                if (item.manifest.entrypoint) {\n                                    item.finaluri += item.manifest.entrypoint;\n                                }\n                            }\n\n                            item.thumb = $boaSearch.boasearch('choosePreview', item);\n\n                            var $item = $(itemcontent(item));\n                            $item.data('metadata', item);\n                            $item.appendTo($target);\n\n                            binditem($item);\n                        });\n                    },\n                    onerror: function(error) {\n                        var $target = $errorBox;\n                        $target.empty();\n\n                        var $node = showmessage(error.message, 'error', error.info, true);\n                        $target.append($node);\n\n                        $node.find('button.close').on('click', function() {\n                            $node.remove();\n                        });\n\n                        Log.debug(error);\n\n                        $target.removeClass('loading');\n                    }\n                }\n            });\n\n            $searchResult.find('> button').on('click', function() {\n                $boaSearch.boasearch('nextsearch');\n            });\n\n        });\n\n        var $saveselection = $('#boa-currentselection .boa-saveselection');\n        $saveselection.hide();\n        $saveselection.on('click', function() {\n            var $thisbutton = $(this);\n\n            var data = [];\n            for (var about in global.selected) {\n                data.push(about);\n            }\n\n            Ajax.call([{\n                methodname: 'mod_boa_select_resources',\n                args: {\n                    cmid: cmid,\n                    list: data\n                }\n            }])[0].then(function(data) {\n\n                if (data) {\n                    let $msg = showmessage(s.saved, 'success', '', true);\n                    $saveselection.after($msg);\n                } else {\n                    let $msg = showmessage(s.notsaved, 'error', '', true);\n                    $saveselection.after($msg);\n                }\n\n                $thisbutton.hide();\n            }).fail(function(e) {\n                Log.debug('Error saving resources selected');\n                Log.debug(e);\n            });\n        });\n\n    };\n\n    return {\n        init: init\n    };\n});\n"],"names":["define","$","ModalFactory","ModalEvents","Templates","Str","Log","Ajax","$errorBox","global","selected","strings","key","component","s","boasearch","el","params","$boasearchBox","$boasearch","$boasearchSuggestions","cacheResults","requestObjects","startRecord","wrap","parent","append","customReset","empty","hide","data","options","extend","defaults","events","results","conf","attr","methods","init","apiuri","txt","level","debug","on","event","keyCode","preventDefault","previousItemMarkup","nextItemMarkup","val","specialKeys","length","indexOf","minLetters","printSuggestions","search","window","setTimeout","getItemMarkup","item","query","text","highlightString","$item","$this","this","str","n","toLowerCase","before","substr","word","after","newposition","$current","find","index","removeClass","$new","children","eq","addClass","printItemsMarkup","title","each","k","show","initSearch","onstart","target","printResultSearch","onfound","$target","$html","preview","choosePreview","about","metadata","general","none","description","manifest","entrypoint","alternatebase","id","alterpath","alternate","request","abort","uri","suggestionsSize","filters","join","filter","get","sort","a","b","size","currentTime","Date","now","timeQuery","cacheLife","resultsSize","value","m","meta","ajax","url","dataType","success","error","onerror","xhr","responseText","parseJSON","fail","searchMore","restart","catalogues","template","fn","paramval","undefined","showmessage","type","info","asreturn","content","innerHTML","replace","html","itemcontent","technical","format","thumb","social","comments","score","count","sum","views","binditem","modalresource","then","custom","$res","conexion_type","$reslink","outerHTML","match","src","name","e","test","customicon","chooseview","avg","downloadable","isdownloadable","encodeURI","socialnetworksitems","socialnetworks","i","v","icon","push","keywords","render","$thisobject","detach","removeselected","refreshadded","catch","create","body","promise","modal","itemdata","setTitle","getModal","getRoot","hidden","getBody","pause","$container","blockid","cmid","boauri","pagesize","forEach","one","get_strings","pos","$thisblock","$searchResult","$boaSearch","more","start","finaluri","appendTo","noresultsfound","$node","message","remove","$saveselection","$thisbutton","call","methodname","args","list","$msg","saved","notsaved"],"mappings":"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"}