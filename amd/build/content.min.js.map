{"version":3,"file":"content.min.js","sources":["../src/content.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * To display the content of the module.\n *\n * @module     mod_boa/content\n * @copyright  2024 David Herney @ BambuCo\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport $ from 'jquery';\nimport Log from 'core/log';\nimport * as BoAUtil from 'mod_boa/util';\n\n// Global variables.\nvar $contentplay;\nvar $contentplaybody;\nvar $contentplaytitle;\nvar $contentlist;\n\n// Private functions.\n\nvar binditem = function($item) {\n    $item.on('click', function() {\n        var $thisitem = $(this);\n\n        if ($thisitem.hasClass('boa-content-active')) {\n            return;\n        }\n\n        var data = $item.data('data');\n        $contentplaybody.children().hide();\n\n        var $existicontent = $contentplaybody.find('[data-idresource=\"' + data.id + '\"]');\n        if ($existicontent.length > 0) {\n            $existicontent.show();\n        } else {\n            var maincontent = BoAUtil.chooseView(data);\n            var $maincontent = $('<div></div>');\n            if (typeof maincontent == 'object') {\n                $maincontent.append(maincontent);\n            } else {\n                $maincontent.html(maincontent);\n            }\n\n            $maincontent.attr('data-idresource', data.id);\n            $contentplaybody.append($maincontent);\n\n            /* ToDo: The next code has problem with cross-domain. We need to find a solution. */\n            if ($maincontent.children().first().is('iframe')) {\n                var iframe = $maincontent.children().first()[0];\n                // Adjusting the iframe height onload event.\n                iframe.onload = function() {\n                    iframe.style.height = iframe.contentWindow.document.body.scrollHeight + 'px';\n                    iframe.style.width = iframe.contentWindow.document.body.scrollWidth + 'px';\n                };\n            }\n        }\n\n        $contentplaytitle.html(data.metadata.general.title.none);\n        $contentlist.find('.boa-content-active').removeClass('boa-content-active');\n        $thisitem.addClass('boa-content-active');\n\n    });\n};\n\n/**\n * Component initialization.\n *\n * @param {array} uris The resource URIs. In order to load the content.\n */\nexport const init = (uris) => {\n\n    $contentplay = $('#boa-contentplay');\n    $contentplaytitle = $('<h2></h2>');\n    $contentplay.append($contentplaytitle);\n    $contentplaybody = $('<div></div>');\n    $contentplay.append($contentplaybody);\n    $contentlist = $('#boa-contentlist');\n\n    // Required for some SCORM packages to work on the page, mainly those created with Tepuy.\n    window.scormplayerdata = {\"courseid\": M.cfg.courseId};\n\n    $.each(uris, function(index, uri) {\n\n        $.get(uri, [], function(data) {\n            let $content = $('<div></div>');\n\n            if (typeof data === 'object' && data.error) {\n                let msg = BoAUtil.showMessage(data.error);\n                $content.append(msg);\n            } else {\n                data.thumb = BoAUtil.choosePreview(data);\n                $content = $(BoAUtil.itemContent(data));\n                $content.data('data', data);\n                binditem($content);\n            }\n\n            $contentlist.append($content);\n\n            if (index === 0) {\n                $content.trigger('click');\n            }\n        })\n        .fail(function() {\n            Log.error('Error loading the content: ' + uri);\n        });\n\n    });\n\n};\n"],"names":["$contentplay","$contentplaybody","$contentplaytitle","$contentlist","uris","append","window","scormplayerdata","M","cfg","courseId","each","index","uri","get","data","$content","error","msg","BoAUtil","showMessage","thumb","choosePreview","itemContent","$item","on","$thisitem","this","hasClass","children","hide","$existicontent","find","id","length","show","maincontent","chooseView","$maincontent","html","attr","first","is","iframe","onload","style","height","contentWindow","document","body","scrollHeight","width","scrollWidth","metadata","general","title","none","removeClass","addClass","trigger","fail"],"mappings":";;;;;;;SA4BIA,aACAC,iBACAC,kBACAC,g1BAqDiBC,OAEjBJ,cAAe,mBAAE,oBACjBE,mBAAoB,mBAAE,aACtBF,aAAaK,OAAOH,mBACpBD,kBAAmB,mBAAE,eACrBD,aAAaK,OAAOJ,kBACpBE,cAAe,mBAAE,oBAGjBG,OAAOC,gBAAkB,UAAaC,EAAEC,IAAIC,0BAE1CC,KAAKP,MAAM,SAASQ,MAAOC,qBAEvBC,IAAID,IAAK,IAAI,SAASE,UAChBC,UAAW,mBAAE,kBAEG,iBAATD,MAAqBA,KAAKE,MAAO,KACpCC,IAAMC,QAAQC,YAAYL,KAAKE,OACnCD,SAASX,OAAOa,UAEhBH,KAAKM,MAAQF,QAAQG,cAAcP,MACnCC,UAAW,mBAAEG,QAAQI,YAAYR,OACjCC,SAASD,KAAK,OAAQA,OAxEdS,MAyECR,UAxEfS,GAAG,SAAS,eACVC,WAAY,mBAAEC,UAEdD,UAAUE,SAAS,2BAInBb,KAAOS,MAAMT,KAAK,QACtBd,iBAAiB4B,WAAWC,WAExBC,eAAiB9B,iBAAiB+B,KAAK,qBAAuBjB,KAAKkB,GAAK,SACxEF,eAAeG,OAAS,EACxBH,eAAeI,WACZ,KACCC,YAAcjB,QAAQkB,WAAWtB,MACjCuB,cAAe,mBAAE,kBACK,iBAAfF,YACPE,aAAajC,OAAO+B,aAEpBE,aAAaC,KAAKH,aAGtBE,aAAaE,KAAK,kBAAmBzB,KAAKkB,IAC1ChC,iBAAiBI,OAAOiC,cAGpBA,aAAaT,WAAWY,QAAQC,GAAG,UAAW,KAC1CC,OAASL,aAAaT,WAAWY,QAAQ,GAE7CE,OAAOC,OAAS,WACZD,OAAOE,MAAMC,OAASH,OAAOI,cAAcC,SAASC,KAAKC,aAAe,KACxEP,OAAOE,MAAMM,MAAQR,OAAOI,cAAcC,SAASC,KAAKG,YAAc,OAKlFlD,kBAAkBqC,KAAKxB,KAAKsC,SAASC,QAAQC,MAAMC,MACnDrD,aAAa6B,KAAK,uBAAuByB,YAAY,sBACrD/B,UAAUgC,SAAS,0BAvCZ,IAASlC,MA4EZrB,aAAaE,OAAOW,UAEN,IAAVJ,OACAI,SAAS2C,QAAQ,YAGxBC,MAAK,wBACE3C,MAAM,8BAAgCJ"}